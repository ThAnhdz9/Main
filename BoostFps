local MAX_FPS = 360
local MIN_FPS = 5
local ENABLE_RENDER = true
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Lighting = game:GetService("Lighting")
local Workspace = game:GetService("Workspace")
local Players = game:GetService("Players")
local Player = Players.LocalPlayer
local PlayerGui = Player:WaitForChild("PlayerGui")

local blackScreen
local lastClickTime = 0
local doubleClickInterval = 0.3

local function createBlackScreen()
    if not blackScreen then
        blackScreen = Instance.new("ScreenGui")
        blackScreen.Name = "BlackScreen"
        blackScreen.IgnoreGuiInset = true
        blackScreen.ResetOnSpawn = false

        local blackFrame = Instance.new("Frame")
        blackFrame.Size = UDim2.new(1, 0, 1, 0)
        blackFrame.Position = UDim2.new(0, 0, 0, 0)
        blackFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
        blackFrame.BackgroundTransparency = 0
        blackFrame.BorderSizePixel = 0
        blackFrame.Parent = blackScreen

        blackScreen.Parent = PlayerGui
    end
end

local function removeBlackScreen()
    if blackScreen then
        blackScreen:Destroy()
        blackScreen = nil
    end
end

local function disableEffects()
    Lighting.GlobalShadows = false
    Lighting.Brightness = 0
    Lighting.FogEnd = 0
    Lighting.Ambient = Color3.fromRGB(0, 0, 0)

    for _, sound in ipairs(game:GetDescendants()) do
        if sound:IsA("Sound") then
            sound:Stop()
        end
    end

    for _, obj in ipairs(Workspace:GetDescendants()) do
        if obj:IsA("BasePart") or obj:IsA("MeshPart") or obj:IsA("UnionOperation") then
            obj.Anchored = true
            obj.CanCollide = false
            obj.Transparency = 1
        end
    end

    local effects = {"ParticleEmitter", "Trail", "Decal", "SpecialMesh"}
    for _, obj in ipairs(Workspace:GetDescendants()) do
        if table.find(effects, obj.ClassName) then
            obj:Destroy()
        end
    end

    for _, cloud in ipairs(Lighting:GetChildren()) do
        if cloud:IsA("Clouds") then
            cloud:Destroy()
        end
    end
end

local function deleteMap()
    for _, obj in ipairs(Workspace:GetChildren()) do
        if not obj:IsA("Terrain") then
            if obj:IsA("Model") or obj:IsA("BasePart") then
                obj:Destroy()
            end
        end
    end
end

local function setRenderState(enabled)
    if enabled then
        disableEffects()
        deleteMap()
        createBlackScreen()
        RunService.Heartbeat:Connect(function() end)
        RunService.RenderStepped:Connect(function() end)
    else
        removeBlackScreen()
    end
end

UserInputService.WindowFocused:Connect(function()
    if ENABLE_RENDER then
        setRenderState(true)
    end
    setfpscap(MAX_FPS)
end)

UserInputService.WindowFocusReleased:Connect(function()
    if ENABLE_RENDER then
        setRenderState(false)
    end
    setfpscap(MIN_FPS)
end)

UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        local currentTime = tick()
        if currentTime - lastClickTime <= doubleClickInterval then
            removeBlackScreen()
        end
        lastClickTime = currentTime
    end
end)
